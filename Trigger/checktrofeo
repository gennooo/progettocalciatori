--un trofeo che compare pi√π volte nella tabella trofeo deve sempre essere o di squadra o individuale
CREATE OR REPLACE FUNCTION checktrofeo()
RETURNS TRIGGER AS $$
DECLARE
controllosq BOOLEAN;
BEGIN
	--controllo prima l'esistenza del trofeo stesso nella tabella
	  SELECT Squadra INTO controllosq
	  FROM Trofeo
	  WHERE nome_trofeo = New.nome_trofeo
	  LIMIT 1;

	  IF controllosq is NOT NULL AND controllosq <> New.Squadra THEN 
	
		RAISE EXCEPTION 'Trofeo % non del tipo giusto. Dovrebbe essere %', NEW.nome_trofeo, controllosq;
		
	  END IF;

	RETURN NEW;
END;
$$ Language plpgsql;

CREATE TRIGGER checktrofeo
BEFORE INSERT ON Trofeo
FOR EACH ROW
EXECUTE FUNCTION checktrofeo();
